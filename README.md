# NaDD DDoS Protection

__NaDD__ - помощник в противодействии DDoS атак. Идеология скрипта заключается в том, что он точечно по сервисам может отслеживать активность и выставлять блокировки на уровне iptables на заданный timeout. Вы можете использовать данный скрипт не только для предотвращения DDoS атак на Web но и на другие сервисы, например SIP. С помощью указания порта вашего сервиса вы можете временно или на длительный срок блокировать точечные IP адреса или целые сети, в зависимости от запуска скрипта.

## Установка.
Создайте директорию на сервере `/var/lib/naad`

```shell script
sudo mkdir -p /var/lib/nadd
```

Перейдите в раздел [Releases](https://github.com/pipisco/nadd/releases) и скачайте последнюю версию на сервере в директорию `/opt/`

```shell script
sudo  wget -O /opt/nadd.tar.gz https://github.com/pipisco/nadd/archive/v1.0.2.tar.gz
```

Распакуйте архив, находясь в директории `/opt/`

```shell script
sudo  tar -xzf nadd.tar.gz
```

Перенесит скрипт `nudd.sh` в директори `/usr/local/bin` следующим образом

```
sudo mv nadd-1.0.2/src/nadd.sh /usr/local/bin/nadd
```
Предоставте права запуска скрипту выполнив:

```shell script
sudo chmod a+x /usr/local/bin/nadd
```
На данном этапе, установка закончена.

## Использование
Запуск скрипта производится с учетом ключей

|       **Параметр**        |   **Тип**    |                       **Описание**                             |
|:--------------------------|-------------:|:---------------------------------------------------------------|
| `-p`                      | `int`        | Номер порта, на котором необходимо применить DDoS protection. В случае если у вас Web protection, вам необходимо запустить `nadd` с портом `443` или если вам необходимо выполнить протекцию SIP Gate, порт вы можете указать 5060 |
| `-t`                      | `int`        | Основной параметр порога соединений с одного IP. Все IP или сети, которые обращаются на ваш сервис выше заданного порога будут заблокированы. |
| `-m`                      | `int`        | Время жизни, в минутах, сколько необходимо, чтобы правило блокировки действовало. |
| `-n`                      | -            | В случае, если вы запускаете скрипт с ключом `-n`, скрипт будет блокировать сети с IP адресов, входящих в этот диапазон, происходит DDoS атака. Данный ключ необходимо применять только в случае высокой необходимости |

Пример запуска блокировки на 15 минут, всех IP адресов, с которых происходит больше 10 запросов

```shell script
sudo nadd -t 10 -p 443 -m 15
```

## Cron
Разблокировка IP адресов, во время DDoS атаки, выполняется каждый раз после очередного запуска скрипта. Для автоматизации, вам необходимо добавить данный вызов в `crontab` и вызывать команду каждую минуту. Выполните `sudo crontab -e` и добавьте правило

```shell script
* * * * * root sudo nadd -t 10 -p 443 -m 15 > /dev/null
```

После того, как DDoS атака будет предотвращена, мы настоятельно рекомендуем, убрать все правила из crontab и перезапустить ваш iptables до стандартных правил, вашего сервера.
